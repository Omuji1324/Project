
@model LibData.Order
@{
    int i = 0;
    LibData.Provider.WarehouseProvider warehouseProvider = new LibData.Provider.WarehouseProvider();
}
<style>
    input, select, textarea {
        max-width: 100%
    }
</style>
<div class="shopping-cart">
    <div class="px-4 px-lg-0">

        <div class="pb-5">
            <div class="container">
                <h3 class="" align="center">Đặt hàng</h3>
                <form class=" py-5 p-4 bg-white rounded shadow-sm" id="form-order" action="/Cart/Order" method="post">
                    <div class="row">
                        <div class="col-12" id="success">
                            @Html.ValidationMessage("success", new { @id = "msgsuccess", @style = "font-size:20px" })
                        </div>
                        <div class="col-12" id="error">
                            @Html.ValidationMessage("error", new { @id = "msgerror", @style = "font-size:20px" })
                        </div>
                    </div>
                    @if (Model.OrderDetails.Count > 0)
                    {

                        <div class="row">
                            <div class="col-lg-4">
                                <div class="bg-light rounded-pill px-4 py-3 text-uppercase font-weight-bold">Thông tin khách hàng</div>
                                <div class="mt-3">

                                    <div class="form-group pb-3">
                                        <input type="text" placeholder="Số điện thoại nhận hàng" id="Phone" value="@Model.Phone" name="Phone" aria-describedby="button-addon3" maxlength="11" class="Phone form-control ">
                                        @Html.ValidationMessage("Phone", new { @class = "text-danger" })
                                    </div>

                                    <div class="form-group pb-3">
                                        <input type="text" placeholder="Họ tên" aria-describedby="button-addon3" value="@Model.BuyerName" name="BuyerName" maxlength="255" class="form-control ">
                                        @Html.ValidationMessage("BuyerName", new { @class = "text-danger" })
                                        @*<div class="input-group-append border-0">
                                <button id="button-addon3" type="button" class="btn btn-dark px-4 rounded-pill"><i class="fa fa-gift mr-2"></i>Apply coupon</button>
                            </div>*@
                                    </div>

                                    <div class="form-group pb-3">
                                        <select aria-describedby="button-addon3" class="form-control" name="ProvinceId">
                                            <option value="-1">Tỉnh / Thành phố</option>
                                            @foreach (var item in ViewBag.Province as List<LibData.Province>)
                                            {
                                                <option value="@item.Id" @(item.Id==@Model.ProvinceId?"selected":"")>@item.Name</option>
                                            }
                                        </select>
                                        @Html.ValidationMessage("ProvinceId", new { @class = "text-danger" })
                                    </div>
                                    <div class="form-group pb-3">
                                        <input type="text" placeholder="Địa chỉ nhận hàng" value="@Model.AddressTo" aria-describedby="button-addon3" maxlength="510" name="AddressTo" class="form-control ">
                                        @Html.ValidationMessage("AddressTo", new { @class = "text-danger" })
                                    </div>

                                    @*<div class="input-group mb-4 border rounded-pill p-2">
                            <input type="text" placeholder="Mã giảm giá" aria-describedby="button-addon3" class="form-control border-0">
                            <div class="input-group-append border-0">
                                <button id="button-addon3" type="button" class="btn btn-dark px-4 rounded-pill"><i class="fa fa-gift mr-2"></i>Xác nhận</button>
                            </div>
                        </div>*@
                                    <p class="font-italic mb-4">Ghi chú cho người bán</p>
                                    <textarea name="Note" rows="5" maxlength="2048" class="form-control"  value="@Model.Note" style="max-width:100%"></textarea>

                                </div>

                            </div>
                            <div class="col-lg-8">
                                <div class="bg-light rounded-pill px-4 py-3 text-uppercase font-weight-bold">Chi tiết đơn hàng </div>
                                <div class="mt-3">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th scope="col" class="border-0 bg-light">
                                                        <div class="p-2 px-3 text-uppercase">Sản phẩm</div>
                                                    </th>
                                                    <th scope="col" class="border-0 bg-light">
                                                        <div class="py-2 text-uppercase">Đơn giá</div>
                                                    </th>
                                                    <th scope="col" class="border-0 bg-light">
                                                        <div class="py-2 text-uppercase">Số lượng</div>
                                                    </th>
                                                    <th scope="col" class="border-0 bg-light">
                                                        <div class="py-2 text-uppercase">Tổng tiền</div>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (Model.OrderDetails != null)
                                                {
                                                    foreach (var item in Model.OrderDetails)
                                                    {

                                                        <tr>
                                                            <th scope="row" class="border-0">
                                                                @{
                                                                    LibData.Warehouse warehouse = warehouseProvider.GetById(item.WarehouseId.Value);
                                                                    <div class="p-2">
                                                                        <img src="https://res.cloudinary.com/mhmd/image/upload/v1556670479/product-1_zrifhn.jpg" alt="" width="70" class="img-fluid rounded shadow-sm">
                                                                        <div class="ml-3 d-inline-block align-middle">
                                                                            <h5 class="mb-0"> <a href="#" class="text-dark d-inline-block align-middle">@warehouse.ProductImg.Product.Name - @warehouse.ProductImg.Color</a></h5>
                                                                            <span class="text-muted font-weight-normal font-italic d-block">VN : @warehouse.Size.VN - US : @warehouse.Size.US - UK : @warehouse.Size.UK</span>
                                                                        </div>
                                                                    </div>
                                                                }

                                                            </th>

                                                            <td class="border-0 align-middle">
                                                                <strong>@item.Price VNĐ</strong>
                                                            </td>

                                                            <td class="border-0 align-middle">
                                                                <strong>@item.Amount</strong>
                                                            </td>
                                                            <td class="border-0 align-middle">
                                                                @{
                                                                    int totalProduct = item.Amount.Value * item.Price.Value;
                                                                    <strong>@totalProduct VNĐ</strong>
                                                                }

                                                            </td>
                                                        </tr>
                                                    }
                                                }
                                                <tr>
                                                    <td colspan="3"><strong class="text-muted">Tổng tiền </strong></td>

                                                    <td colspan="2">
                                                        <strong>
                                                            @Model.Total VNĐ
                                                        </strong>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    @*<p class="font-italic mb-4">Shipping and additional costs are calculated based on values you have entered.</p>
                        <ul class="list-unstyled mb-4">
                            <li class="d-flex justify-content-between py-3 border-bottom"></li>
                            <li class="d-flex justify-content-between py-3 border-bottom"><strong class="text-muted">Phí giao hàng</strong><strong>0</strong></li>
                            <li class="d-flex justify-content-between py-3 border-bottom"><strong class="text-muted">Tax</strong><strong>$0.00</strong></li>
                            <li class="d-flex justify-content-between py-3 border-bottom">
                                <strong class="text-muted">Tổng</strong>
                                <h5 class="font-weight-bold">$400.00</h5>
                            </li>
                        </ul><a href="#" class="btn btn-dark rounded-pill py-2 btn-block">Đặt hàng</a>*@
                                </div>
                            </div>
                        </div>

                        <div class="row d-flex justify-content-center mt-3" style="min-height:72px">
                            <div class="col-md-2 col-6 ">
                                <button type="submit" class="btn btn-success btn-block px-4 rounded-pill" @*onclick="UpdateCart();"*@>Đặt hàng</button>
                                @*<a href="#" class="btn btn-dark rounded-pill py-2 btn-block" onclick="ConfirmOrder()">Đặt hàng</a>*@
                            </div>

                        </div>
                    }
                    else
                    {
                        <div class="row d-flex justify-content-center mt-3" style="min-height:72px">
                            <div class="col-md-3 col-6 ">
                                <button class="btn btn-outline-success px-4 rounded-pill btn-block" onclick="window.location.href = ''"><i class="fa fa-chevron-left"></i> Quay lại đặt hàng</button>
                            </div>
                        </div>
                    }
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function ConfirmOrder() {
        loading(true)
        var $form = $("#form-order");
        $.ajax({
            type: "POST",
            url: "/Cart/Order",
            data: $form.serialize(),
            success: function (rs) {
                //var statusCode = xhr.getResponseHeader("statusCode");
                //if (xhr.status == 201) {
                //}
                 $("#form-order").html($(data).find("#form-order").html());
            },

        });
        loading(false)
    }
 
    //input number
    $(document).ready(function () {
        $("#Phone").keypress(function (e) {
            if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
                return false;
            }
        });
    });
 
</script>
<button id="btn_order" style="visibility:hidden">show</button>
<script>
    if ($("#msgsuccess").html() != "") {
        $("#success").addClass("alert alert-success")
        $("#btn_order").click()
    }
    if ($("#msgerror").html() != "") {
        $("#error").addClass("alert alert-danger")
    }
</script>